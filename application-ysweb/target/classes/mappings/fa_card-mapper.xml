<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.ysttench.application.auth.settings.kernel.mapper.FaCardMapper">
	<!--mybatis ehcache缓存配置 -->
	<!-- 以下两个<cache>标签二选一,第一个可以输出日志,第二个不输出日志 <cache type="org.mybatis.caches.ehcache.LoggingEhcache" 
		/> -->
	<!-- <cache type="org.mybatis.caches.ehcache.EhcacheCache"/> -->
	<!-- 以下与实体类的中字段一致 -->
	<select id="findGDMsg"
		resultType="com.ysttench.application.auth.settings.kernel.entity.FaCardFormMap">
		SELECT
		T_FA_CARD.FNUMBER,
		T_FA_CARDDETAIL.FQUANTITY,
		T_BD_UNIT_L.FNAME AS
		UNITNAME,
		T_FA_CARD.FCREATEDATE,
		T_FA_ASSETTYPE_L.FNAME AS TYPENAME,
		T_BD_STAFF_L.FNAME AS USERNAME,
		T_FA_CARD_L.FNAME,
		T_FA_CARD_L.FPKID,
		T_FA_CARDDETAIL.FASSETNO,
		T_FA_POSITION_L.FNAME AS PLACENAME,
		T_BD_DEPARTMENT_L.FNAME AS DEPARTNAME
		FROM
		T_FA_CARD
		LEFT JOIN
		T_FA_CARD_L ON T_FA_CARD.FALTERID = T_FA_CARD_L.FALTERID
		LEFT JOIN
		T_ORG_ORGANIZATIONS_L ON T_FA_CARD.FOWNERORGID =
		T_ORG_ORGANIZATIONS_L.FORGID
		LEFT JOIN T_FA_ASSETTYPE_L ON
		T_FA_CARD.FASSETTYPEID =
		T_FA_ASSETTYPE_L.FID
		LEFT JOIN T_FA_CARDDETAIL
		ON T_FA_CARD.FALTERID = T_FA_CARDDETAIL.FALTERID
		LEFT JOIN
		T_FA_ALLOCATION ON T_FA_CARD.FALTERID =
		T_FA_ALLOCATION.FALTERID
		LEFT
		JOIN T_BD_STAFF_L ON T_FA_ALLOCATION.FUSERID = T_BD_STAFF_L.FSTAFFID
		LEFT JOIN T_BD_UNIT_L ON T_FA_CARD.FUNITID = T_BD_UNIT_L.FUNITID
		LEFT
		JOIN T_FA_POSITION_L ON T_FA_CARDDETAIL.FPOSITIONID =
		T_FA_POSITION_L.FID
		LEFT JOIN T_BD_DEPARTMENT_L ON
		T_FA_ALLOCATION.FUSEDEPTID =
		T_BD_DEPARTMENT_L.FDEPTID
		<if test="organ != null">
			WHERE T_ORG_ORGANIZATIONS_L.FORGID ='${organ}'
			AND
			T_FA_CARD.FASSETCURSTATUS =1
		</if>
		<if test="fbillno != null">
			AND T_FA_CARDDETAIL.FASSETNO like '%${fbillno}%'
		</if>
		GROUP BY
		T_FA_CARD.FNUMBER,
		T_FA_CARDDETAIL.FQUANTITY,
		T_BD_UNIT_L.FNAME,
		T_FA_CARD.FCREATEDATE,
		T_FA_ASSETTYPE_L.FNAME,
		T_FA_CARD_L.FNAME,
		T_FA_CARD_L.FPKID,
		T_BD_STAFF_L.FNAME,
		T_FA_CARDDETAIL.FASSETNO,
		T_FA_POSITION_L.FNAME,
		T_BD_DEPARTMENT_L.FNAME
	</select>
	<select id="findGDMsgByPage"
		resultType="com.ysttench.application.auth.settings.kernel.entity.FaCardFormMap">
		SELECT DISTINCT
		T_FA_CARD.FNUMBER,
		T_FA_CARD_L.FPKID,
		T_FA_CARDDETAIL.FQUANTITY,
		T_BD_UNIT_L.FNAME AS
		UNITNAME,
		T_FA_CARD.FCREATEDATE,
		T_FA_ASSETTYPE_L.FNAME AS TYPENAME,
		T_FA_CARD_L.FNAME,
		T_BD_STAFF_L.FNAME AS USERNAME,
		T_FA_CARDDETAIL.FASSETNO,
		T_FA_POSITION_L.FNAME AS PLACENAME,
		T_BD_DEPARTMENT_L.FNAME AS
		DEPARTNAME,
		T_ORG_ORGANIZATIONS_L.FNAME AS ORGNAME,
		tt.FNAME AS CHANGENAME
		FROM
		T_FA_CARD
		LEFT JOIN T_FA_CARD_L ON T_FA_CARD.FALTERID = T_FA_CARD_L.FALTERID
		LEFT JOIN T_ORG_ORGANIZATIONS_L ON T_FA_CARD.FOWNERORGID =
		T_ORG_ORGANIZATIONS_L.FORGID
		LEFT JOIN T_FA_ASSETTYPE_L ON T_FA_CARD.FASSETTYPEID =
		T_FA_ASSETTYPE_L.FID
		LEFT JOIN T_FA_CARDDETAIL ON T_FA_CARD.FALTERID = T_FA_CARDDETAIL.FALTERID
		LEFT JOIN T_FA_ALLOCATION ON T_FA_CARD.FALTERID =
		T_FA_ALLOCATION.FALTERID
		LEFT JOIN T_BD_STAFF_L ON T_FA_ALLOCATION.FUSERID = T_BD_STAFF_L.FSTAFFID
		LEFT JOIN T_BD_UNIT_L ON T_FA_CARD.FUNITID = T_BD_UNIT_L.FUNITID
		LEFT JOIN T_FA_POSITION_L ON T_FA_CARDDETAIL.FPOSITIONID =
		T_FA_POSITION_L.FID
		LEFT JOIN T_BD_DEPARTMENT_L ON T_FA_ALLOCATION.FUSEDEPTID =
		T_BD_DEPARTMENT_L.FDEPTID
		LEFT JOIN T_FA_CHANGEALLOC ON T_FA_CHANGEALLOC.FPREALLOCASSETNO =
		T_FA_CARDDETAIL.FASSETNO
		LEFT JOIN T_BD_STAFF_L tt ON T_FA_CHANGEALLOC.FALLOCUSERID = tt.FSTAFFID
		WHERE 1=1
		<if test="searchValue != null and searchValue != ''">
			AND (T_BD_DEPARTMENT_L.FNAME like '%${searchValue}%' OR T_FA_ASSETTYPE_L.FNAME like '%${searchValue}%' OR T_FA_CARD.FNUMBER like '%${searchValue}%' OR T_FA_CARDDETAIL.FASSETNO like '%${searchValue}%' OR
			T_FA_CARD_L.FNAME like '%${searchValue}%' OR T_FA_POSITION_L.FNAME
			like '%${searchValue}%' OR T_BD_STAFF_L.FNAME like
			'%${searchValue}%')
		</if>
		<if test="organ != null">
			AND T_ORG_ORGANIZATIONS_L.FNAME ='${organ}' AND T_FA_CARD.FISNEWREC=2
		</if>
		GROUP BY
		T_FA_CARD.FNUMBER,
		T_FA_CARDDETAIL.FQUANTITY,
		T_BD_UNIT_L.FNAME,
		T_FA_CARD_L.FPKID,
		T_FA_CARD.FCREATEDATE,
		T_FA_ASSETTYPE_L.FNAME,
		T_FA_CARD_L.FNAME,
		T_FA_CARDDETAIL.FASSETNO,
		T_FA_POSITION_L.FNAME ,
		T_BD_STAFF_L.FNAME ,
		T_BD_DEPARTMENT_L.FNAME,
		T_ORG_ORGANIZATIONS_L.FNAME,
		tt.FNAME
		<if test="column != null">
			order by ${column} ${sort}
		</if>
	</select>
	<select id="findDetailCardMsg"
		resultType="com.ysttench.application.auth.settings.kernel.entity.FaCardFormMap">
		SELECT
		T_FA_CARD.FNUMBER,
		T_FA_CARDDETAIL.FASSETNO,
		T_FA_CARD_L.FNAME,
		T_FA_POSITION_L.FNAME AS PLACENAME ,
		T_BD_STAFF_L.FNAME AS USERNAME,
		T_BD_DEPARTMENT_L.FNAME AS DEPARTNAME
		FROM
		T_FA_CARD
		LEFT JOIN
		T_FA_CARD_L ON T_FA_CARD.FALTERID = T_FA_CARD_L.FALTERID
		LEFT JOIN
		T_ORG_ORGANIZATIONS_L ON T_FA_CARD.FASSETORGID =
		T_ORG_ORGANIZATIONS_L.FORGID
		LEFT JOIN T_FA_ASSETTYPE_L ON
		T_FA_CARD.FASSETTYPEID =
		T_FA_ASSETTYPE_L.FID
		LEFT JOIN T_FA_CARDDETAIL
		ON T_FA_CARD.FALTERID = T_FA_CARDDETAIL.FALTERID
		LEFT JOIN T_BD_UNIT_L
		ON T_FA_CARD.FUNITID = T_BD_UNIT_L.FUNITID
		LEFT JOIN T_FA_POSITION_L ON
		T_FA_CARDDETAIL.FPOSITIONID =
		T_FA_POSITION_L.FID
		LEFT JOIN
		T_FA_ALLOCATION ON T_FA_CARD.FALTERID = T_FA_ALLOCATION.FALTERID
		LEFT
		JOIN T_BD_STAFF_L ON T_FA_ALLOCATION.FUSERID =
		T_BD_STAFF_L.FSTAFFID
		LEFT JOIN T_BD_DEPARTMENT_L ON T_FA_ALLOCATION.FUSEDEPTID =
		T_BD_DEPARTMENT_L.FDEPTID
		<if test="id != null">
			WHERE
			T_FA_CARD_L.FPKID IN ( ${id} )
		</if>
		GROUP BY
		T_FA_CARD.FNUMBER,
		T_FA_CARDDETAIL.FASSETNO,
		T_FA_CARD_L.FNAME,
		T_FA_POSITION_L.FNAME,
		T_BD_STAFF_L.FNAME,
		T_BD_DEPARTMENT_L.FNAME
	</select>
	<select id="findGdPdMsg"
		resultType="com.ysttench.application.auth.settings.kernel.entity.FaCardFormMap">
		SELECT
		T_FA_COUNTINGREPORT.FID,
		T_FA_COUNTINGREPORT.FBILLNO,
		T_FA_COUNTINGREPORT.FCREATEDATE AS FDATE,
		T_FA_COUNTINGREPORT.FDOCUMENTSTATUS
		FROM
		T_FA_COUNTINGREPORT
		LEFT JOIN
		T_ORG_ORGANIZATIONS_L ON T_FA_COUNTINGREPORT.FASSETORGID =
		T_ORG_ORGANIZATIONS_L.FORGID
		<if test="organ != null">
			WHERE T_ORG_ORGANIZATIONS_L.FORGID ='${organ}'
		</if>
		<if test="day != null">
			AND DATEDIFF( day, T_PRD_PICKMTRL.FDATE, getdate ( ) ) = 0
		</if>
		<if test="month != null">
			AND DATEDIFF( month, T_PRD_PICKMTRL.FDATE, getdate ( ) ) =
			0
		</if>
		<if test="week != null">
			AND DATEDIFF( week,T_PRD_PICKMTRL.FDATE, getdate ( ) ) = 0
		</if>
		ORDER BY T_FA_COUNTINGREPORT.FCREATEDATE DESC
	</select>
	<select id="findDetaiGdPdMsg"
		resultType="com.ysttench.application.auth.settings.kernel.entity.FaCardFormMap">
		SELECT
		T_FA_COUNTINGRPTENTRY.FENTRYID,
		T_FA_COUNTINGRPTENTRY.FASSETNUMBER,
		T_FA_COUNTINGRPTENTRY.FCARDNUMBER,
		T_FA_CARD_L.FNAME,
		T_FA_COUNTINGRPTENTRY.FBOOKQTY,
		T_FA_COUNTINGRPTENTRY.FINITQTY
		FROM
		T_FA_COUNTINGRPTENTRY
		LEFT JOIN
		T_FA_COUNTINGREPORT ON T_FA_COUNTINGREPORT.FID =
		T_FA_COUNTINGRPTENTRY.FID
		LEFT JOIN T_FA_CARD ON
		T_FA_COUNTINGRPTENTRY.FCARDNUMBER =
		T_FA_CARD.FNUMBER
		LEFT JOIN
		T_FA_CARD_L ON T_FA_CARD.FALTERID = T_FA_CARD_L.FALTERID
		WHERE
		T_FA_COUNTINGRPTENTRY.FBOOKQTY >0
		<if test="fid != null">
			AND T_FA_COUNTINGREPORT.FID IN (${fid})
		</if>
		GROUP BY
		T_FA_COUNTINGRPTENTRY.FENTRYID,
		T_FA_COUNTINGRPTENTRY.FASSETNUMBER,
		T_FA_COUNTINGRPTENTRY.FCARDNUMBER,
		T_FA_CARD_L.FNAME,
		T_FA_COUNTINGRPTENTRY.FBOOKQTY,
		T_FA_COUNTINGRPTENTRY.FINITQTY
	</select>
	<select id="findGdpd"
		resultType="com.ysttench.application.auth.settings.kernel.entity.FaCardFormMap">
		SELECT
		T_FA_COUNTINGREPORT.FDOCUMENTSTATUS,
		T_FA_COUNTINGRPTENTRY.FBOOKQTY
		FROM
		T_FA_COUNTINGREPORT
		LEFT JOIN
		T_FA_COUNTINGRPTENTRY ON T_FA_COUNTINGREPORT.FID =
		T_FA_COUNTINGRPTENTRY.FID
		<if test="fentryid != null">
			WHERE
			T_FA_COUNTINGRPTENTRY.FENTRYID = '${fentryid}'
		</if>
		<if test="fid != null">
			WHERE
			T_FA_COUNTINGREPORT.FID = '${fid}'
		</if>
	</select>
	<update id="edit"
		parameterType="com.ysttench.application.auth.settings.kernel.entity.FaCardFormMap">
		update T_FA_COUNTINGRPTENTRY set
		<if test="fvariance != null">FVARIANCE = #{fvariance,jdbcType=VARCHAR},</if>
		<if test="finitqty != null">FINITQTY = #{finitqty,jdbcType=VARCHAR}</if>
		WHERE FENTRYID = #{fentryid}
	</update>
</mapper>