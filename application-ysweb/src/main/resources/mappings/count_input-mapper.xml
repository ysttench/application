<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.ysttench.application.auth.settings.kernel.mapper.CountInputMapper">
	<!--mybatis ehcache缓存配置 -->
	<!-- 以下两个<cache>标签二选一,第一个可以输出日志,第二个不输出日志 <cache type="org.mybatis.caches.ehcache.LoggingEhcache" 
		/> -->
	<!-- <cache type="org.mybatis.caches.ehcache.EhcacheCache"/> -->
	<!-- 以下与实体类的中字段一致 -->
	<select id="findMsg"
		resultType="com.ysttench.application.auth.settings.kernel.entity.CountInputFormMap">
		SELECT
		T_STK_STKCOUNTINPUT.FID,
		T_STK_STKCOUNTINPUT.FBILLNO,
		T_STK_STKCOUNTINPUT.FDATE,
		T_STK_STKCOUNTINPUT.FDOCUMENTSTATUS
		FROM
		T_STK_STKCOUNTINPUT
		LEFT JOIN T_ORG_ORGANIZATIONS_L ON
		T_STK_STKCOUNTINPUT.FSTOCKORGID =
		T_ORG_ORGANIZATIONS_L.FORGID
		<if test="organ != null">
			WHERE T_ORG_ORGANIZATIONS_L.FORGID ='${organ}'
		</if>
		<if test="day != null">
			AND DATEDIFF( day, T_PRD_PICKMTRL.FDATE, getdate ( ) ) = 0
		</if>
		<if test="month != null">
			AND DATEDIFF( month, T_PRD_PICKMTRL.FDATE, getdate ( ) ) =
			0
		</if>
		<if test="week != null">
			AND DATEDIFF( week,T_PRD_PICKMTRL.FDATE, getdate ( ) ) = 0
		</if>
		ORDER BY T_STK_STKCOUNTINPUT.FDATE DESC
	</select>
	<select id="findDetaiMsg"
		resultType="com.ysttench.application.auth.settings.kernel.entity.CountInputFormMap">
SELECT
	T_STK_STKCOUNTINPUTENTRY.FENTRYID,
	T_BD_MATERIAL.FNUMBER AS MATERILNUMBER,
	T_BD_MATERIAL_L.FNAME,
	T_STK_STKCOUNTINPUTENTRY.FBaseAcctQty,
	T_STK_STKCOUNTINPUTENTRY.FBaseCountQty,
	T_STK_STKCOUNTINPUTENTRY.FLOT,
	T_STK_STKCOUNTINPUTENTRY.FOWNERTYPEID,
	org1.FNUMBER AS FOWNERNUMBER,
	T_STK_STKCOUNTINPUTENTRY.FKEEPERTYPEID,
	org2.FNUMBER AS KEEPERNUMBER,
	T_STK_STKCOUNTINPUTENTRY.FSTOCKLOCID,
	UNIT1.FNAME AS UNITNAME,
	T_STK_STKCOUNTINPUTENTRY.FProduceDate,
	T_STK_STKCOUNTINPUTENTRY.FEXPIRYDATE,
	T_STK_STKCOUNTINPUT.FSchemeNo,
	T_BD_STOCK.FNUMBER  AS STOCKNUMBER
FROM
	T_STK_STKCOUNTINPUT
	LEFT JOIN T_STK_STKCOUNTINPUTENTRY ON T_STK_STKCOUNTINPUT.FID = T_STK_STKCOUNTINPUTENTRY.FID
	LEFT JOIN T_BD_MATERIAL ON T_STK_STKCOUNTINPUTENTRY.FMATERIALID = T_BD_MATERIAL.FMATERIALID
	LEFT JOIN T_BD_MATERIAL_L ON T_STK_STKCOUNTINPUTENTRY.FMATERIALID = T_BD_MATERIAL_L.FMATERIALID
	LEFT JOIN T_ORG_ORGANIZATIONS org1 ON T_STK_STKCOUNTINPUTENTRY.FOWNERID = org1.FORGID
	LEFT JOIN T_ORG_ORGANIZATIONS org2 ON T_STK_STKCOUNTINPUTENTRY.FKEEPERID = org2.FORGID
	LEFT JOIN T_BD_UNIT_L UNIT1 ON T_STK_STKCOUNTINPUTENTRY.FUNITID = UNIT1.FUNITID
	LEFT JOIN T_BD_STOCK ON T_STK_STKCOUNTINPUTENTRY.FSTOCKID = T_BD_STOCK.FSTOCKID 
		WHERE
		T_STK_STKCOUNTINPUTENTRY.FBaseAcctQty > 0
		<if test="stock != null and stock != ''">
		AND T_BD_STOCK.FNUMBER = '${stock}'
		</if>
		<if test="fid != null">
			AND T_STK_STKCOUNTINPUT.FID IN (${fid})
		</if>
		GROUP BY
		T_STK_STKCOUNTINPUTENTRY.FENTRYID,
		T_BD_MATERIAL.FNUMBER,
		T_BD_MATERIAL_L.FNAME,
		T_STK_STKCOUNTINPUTENTRY.FBaseAcctQty,
		T_STK_STKCOUNTINPUTENTRY.FBaseCountQty,
		T_STK_STKCOUNTINPUTENTRY.FLOT,
		T_STK_STKCOUNTINPUTENTRY.FOWNERTYPEID,
		org1.FNUMBER,
		T_STK_STKCOUNTINPUTENTRY.FKEEPERTYPEID,
		org2.FNUMBER,
		T_STK_STKCOUNTINPUTENTRY.FSTOCKLOCID,
		UNIT1.FNAME,
		T_STK_STKCOUNTINPUTENTRY.FProduceDate,
		T_STK_STKCOUNTINPUTENTRY.FEXPIRYDATE,
		T_STK_STKCOUNTINPUT.FSchemeNo,
	    T_BD_STOCK.FNUMBER
		ORDER BY T_STK_STKCOUNTINPUTENTRY.FENTRYID DESC
	</select>
	<select id="findDetaipD"
		resultType="com.ysttench.application.auth.settings.kernel.entity.CountInputFormMap">
		SELECT
		T_STK_STKCOUNTINPUTENTRY.FENTRYID,
		T_BD_MATERIAL.FNUMBER AS
		MATERILNUMBER,
		T_BD_MATERIAL_L.FNAME,
		T_STK_STKCOUNTINPUTSERIAL.FSERIALNO,
		T_STK_STKCOUNTINPUTENTRY.FBaseAcctQty,
		T_STK_STKCOUNTINPUTENTRY.FBaseCountQty,
		T_STK_STKCOUNTINPUTENTRY.FLOT,
		T_STK_STKCOUNTINPUTENTRY.FOWNERTYPEID,
		org1.FNUMBER AS FOWNERNUMBER,
		T_STK_STKCOUNTINPUTENTRY.FKEEPERTYPEID,
		org2.FNUMBER AS KEEPERNUMBER,
		T_STK_STKCOUNTINPUTENTRY.FSTOCKLOCID,
		UNIT1.FNAME AS UNITNAME,
		T_STK_STKCOUNTINPUTENTRY.FProduceDate,
		T_STK_STKCOUNTINPUTENTRY.FEXPIRYDATE,
		T_STK_STKCOUNTINPUT.FSchemeNo,
		T_BD_STOCK.FNUMBER AS STOCKNUMBER
		FROM
		T_STK_STKCOUNTINPUT
		LEFT JOIN
		T_STK_STKCOUNTINPUTENTRY ON T_STK_STKCOUNTINPUT.FID =
		T_STK_STKCOUNTINPUTENTRY.FID
		LEFT JOIN T_BD_MATERIAL ON
		T_STK_STKCOUNTINPUTENTRY.FMATERIALID =
		T_BD_MATERIAL.FMATERIALID
		LEFT
		JOIN T_BD_MATERIAL_L ON T_STK_STKCOUNTINPUTENTRY.FMATERIALID =
		T_BD_MATERIAL_L.FMATERIALID
		LEFT JOIN T_STK_STKCOUNTINPUTSERIAL ON
		T_STK_STKCOUNTINPUTENTRY.FENTRYID =
		T_STK_STKCOUNTINPUTSERIAL.FENTRYID
		LEFT JOIN T_ORG_ORGANIZATIONS org1 ON
		T_STK_STKCOUNTINPUTENTRY.FOWNERID =
		org1.FORGID
		LEFT JOIN
		T_ORG_ORGANIZATIONS org2 ON T_STK_STKCOUNTINPUTENTRY.FKEEPERID =
		org2.FORGID
		LEFT JOIN T_BD_UNIT_L UNIT1 ON
		T_STK_STKCOUNTINPUTENTRY.FUNITID =
		UNIT1.FUNITID
		LEFT JOIN T_BD_STOCK ON
		T_STK_STKCOUNTINPUTENTRY.FSTOCKID =
		T_BD_STOCK.FSTOCKID
		WHERE
		T_STK_STKCOUNTINPUTENTRY.FBaseAcctQty > 0
		<if test="fid != null">
			AND T_STK_STKCOUNTINPUT.FID = '${fid}'
		</if>
		<if test="fentryid != null">
			AND T_STK_STKCOUNTINPUTENTRY.FENTRYID IN (${fentryid})
		</if>
		GROUP BY
		T_STK_STKCOUNTINPUTENTRY.FENTRYID,
		T_BD_MATERIAL.FNUMBER,
		T_BD_MATERIAL_L.FNAME,
		T_STK_STKCOUNTINPUTSERIAL.FSERIALNO,
		T_STK_STKCOUNTINPUTENTRY.FBaseAcctQty,
		T_STK_STKCOUNTINPUTENTRY.FBaseCountQty,
		T_STK_STKCOUNTINPUTENTRY.FLOT,
		T_STK_STKCOUNTINPUTENTRY.FOWNERTYPEID,
		org1.FNUMBER,
		T_STK_STKCOUNTINPUTENTRY.FKEEPERTYPEID,
		org2.FNUMBER,
		T_STK_STKCOUNTINPUTENTRY.FSTOCKLOCID,
		UNIT1.FNAME,
		T_STK_STKCOUNTINPUTENTRY.FProduceDate,
		T_STK_STKCOUNTINPUTENTRY.FEXPIRYDATE,
		T_STK_STKCOUNTINPUT.FSchemeNo,
		T_BD_STOCK.FNUMBER
		ORDER BY T_STK_STKCOUNTINPUTENTRY.FENTRYID DESC
	</select>
	<select id="findpd"
		resultType="com.ysttench.application.auth.settings.kernel.entity.CountInputFormMap">
		SELECT
		T_STK_STKCOUNTINPUT.FDOCUMENTSTATUS,
		T_STK_STKCOUNTINPUTENTRY.FACCTQTY
		FROM
		T_STK_STKCOUNTINPUT
		LEFT JOIN
		T_STK_STKCOUNTINPUTENTRY ON T_STK_STKCOUNTINPUT.FID =
		T_STK_STKCOUNTINPUTENTRY.FID
		<if test="fentryid != null">
			WHERE
			T_STK_STKCOUNTINPUTENTRY.FENTRYID = '${fentryid}'
		</if>
		<if test="fid != null">
			WHERE
			T_STK_STKCOUNTINPUT.FID = '${fid}'
		</if>
	</select>
	<update id="edit"
		parameterType="com.ysttench.application.auth.settings.kernel.entity.CountInputFormMap">
		update T_STK_STKCOUNTINPUTENTRY set
		<if test="flossqty != null">FLOSSQTY = #{flossqty,jdbcType=VARCHAR},</if>
		<if test="fbaselossqty != null">FBASELOSSQTY=#{fbaselossqty,jdbcType=VARCHAR},</if>
		<if test="fextseclossqty != null">FEXTSECLOSSQTY= #{fextseclossqty,jdbcType=VARCHAR},</if>
		<if test="fseclossqty != null">FSECLOSSQTY= #{fseclossqty,jdbcType=VARCHAR},</if>
		<if test="fbasegainqty != null">FBASEGAINQTY= #{fbasegainqty,jdbcType=VARCHAR},</if>
		<if test="fsecgainqty != null">FSECGAINQTY= #{fsecgainqty,jdbcType=VARCHAR},</if>
		<if test="fextsecgainqty != null">FEXTSECGAINQTY= #{fextsecgainqty,jdbcType=VARCHAR},</if>
		<if test="fbasecountqty != null">FBASECOUNTQTY= #{fbasecountqty,jdbcType=VARCHAR},</if>
		<if test="fseccountqty != null">FSECCOUNTQTY= #{fseccountqty,jdbcType=VARCHAR},</if>
		<if test="fgainqty != null">FGAINQTY = #{fgainqty,jdbcType=VARCHAR},</if>
		<if test="fcounterror != null">FCOUNTERROR = #{fcounterror,jdbcType=VARCHAR},</if>
		<if test="fcountqty != null">FCOUNTQTY = #{fcountqty,jdbcType=VARCHAR}</if>
		WHERE FENTRYID = #{fentryid}
	</update>
	<select id="findCkMsg"
		resultType="com.ysttench.application.auth.settings.kernel.entity.CountInputFormMap">
		SELECT DISTINCT
		T_BD_STOCK.FNUMBER,
		T_BD_STOCK_L.FNAME,
		T_STK_STKCOUNTINPUTENTRY.FID
		FROM
		T_STK_STKCOUNTINPUTENTRY
		LEFT JOIN T_BD_STOCK ON T_STK_STKCOUNTINPUTENTRY.FSTOCKID =
		T_BD_STOCK.FSTOCKID
		LEFT JOIN T_BD_STOCK_L ON T_STK_STKCOUNTINPUTENTRY.FSTOCKID =
		T_BD_STOCK_L.FSTOCKID
		WHERE T_STK_STKCOUNTINPUTENTRY.FID = '${fid}'
	</select>
</mapper>