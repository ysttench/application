<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ysttench.application.auth.settings.kernel.mapper.PrdPickmtrlMapper">
	<!--mybatis ehcache缓存配置 -->
	<!-- 以下两个<cache>标签二选一,第一个可以输出日志,第二个不输出日志 <cache type="org.mybatis.caches.ehcache.LoggingEhcache" 
		/> -->
	<!-- <cache type="org.mybatis.caches.ehcache.EhcacheCache"/> -->
	<!-- 以下与实体类的中字段一致 -->
<select id="findprdMsg" resultType="com.ysttench.application.auth.settings.kernel.entity.PrdPickmtrlFormMap">
SELECT
    T_PRD_PICKMTRL.FID,
	T_PRD_PICKMTRL.FBILLNO,
	T_PRD_PICKMTRL.FDATE,
	T_BD_STAFF_L.FNAME,
	T_PRD_PICKMTRL.FDOCUMENTSTATUS 
FROM
	T_PRD_PICKMTRL
	LEFT JOIN T_PRD_PICKMTRLDATA ON T_PRD_PICKMTRL.FID = T_PRD_PICKMTRLDATA.FID
	LEFT JOIN T_ORG_ORGANIZATIONS_L ON T_PRD_PICKMTRL.FSTOCKORGID = T_ORG_ORGANIZATIONS_L.FORGID
	left join T_BD_STAFF on T_PRD_PICKMTRL.FPICKERID = T_BD_STAFF.FMASTERID
	left join T_BD_STAFF_L on  T_BD_STAFF.FSTAFFID= T_BD_STAFF_L.FSTAFFID
	LEFT JOIN T_BD_MATERIAL ON T_PRD_PICKMTRLDATA.FMATERIALID = T_BD_MATERIAL.FMATERIALID
	LEFT JOIN T_BD_MATERIAL_L ON T_PRD_PICKMTRLDATA.FMATERIALID = T_BD_MATERIAL_L.FMATERIALID
	LEFT JOIN T_BD_STOCK_L ON T_PRD_PICKMTRLDATA.FSTOCKID = T_BD_STOCK_L.FSTOCKID
	LEFT JOIN T_BD_STOCK ON T_PRD_PICKMTRLDATA.FSTOCKID = T_BD_STOCK.FSTOCKID
	WHERE 1=1
	<if test="searchValue != null and searchValue != ''">
	AND T_PRD_PICKMTRL.FBILLNO like '%${searchValue}%'  OR T_BD_MATERIAL.FNUMBER like '%${searchValue}%' OR T_BD_MATERIAL_L.FNAME like '%${searchValue}%' OR T_ORG_ORGANIZATIONS_L.FNAME like '%${searchValue}%' OR T_PRD_PICKMTRLDATA.FLOT like '%${searchValue}%' OR T_BD_STOCK_L.FNAME like '%${searchValue}%'
	</if>
	<if test="organ != null">
	AND T_ORG_ORGANIZATIONS_L.FORGID ='${organ}'
	</if>
		<if test="day != null">
AND DATEDIFF( day, T_PRD_PICKMTRL.FDATE, getdate ( ) ) = 0 
	</if>
		<if test="month != null">
AND DATEDIFF( month, T_PRD_PICKMTRL.FDATE, getdate ( ) ) = 0 
	</if>
		<if test="week != null">
AND DATEDIFF( week,T_PRD_PICKMTRL.FDATE, getdate ( ) ) = 0 
	</if>
	GROUP BY
	T_PRD_PICKMTRL.FID,
	T_PRD_PICKMTRL.FBILLNO,
	T_PRD_PICKMTRL.FDATE,
	T_BD_STAFF_L.FNAME,
	T_PRD_PICKMTRL.FDOCUMENTSTATUS 
ORDER BY
	T_PRD_PICKMTRL.FID DESC
</select>
<select id="findDetailpicMsg" resultType="com.ysttench.application.auth.settings.kernel.entity.PrdPickmtrlFormMap">
SELECT
	T_BD_MATERIAL.FNUMBER,
	T_BD_MATERIAL_L.FNAME,
	T_PRD_PICKMTRLDATA.FAPPQTY,
	T_PRD_PICKMTRLDATA.FSTOCKACTUALQTY,
	T_PRD_PICKMTRLSERIAL.FSERIALNO,
	T_PRD_PICKMTRLDATA.FENTRYID,
	T_BD_MATERIALSTOCK.FISBATCHMANAGE,
	T_PRD_PICKMTRLDATA.FLOT,
	T_PRD_PICKMTRLDATA.FSTOCKID 
FROM
	T_PRD_PICKMTRL
	LEFT JOIN T_PRD_PICKMTRLDATA ON T_PRD_PICKMTRL.FID = T_PRD_PICKMTRLDATA.FID
	LEFT JOIN T_BD_MATERIAL ON T_PRD_PICKMTRLDATA.FMATERIALID = T_BD_MATERIAL.FMATERIALID
	LEFT JOIN T_BD_MATERIAL_L ON T_PRD_PICKMTRLDATA.FMATERIALID = T_BD_MATERIAL_L.FMATERIALID
	LEFT JOIN T_PRD_PICKMTRLSERIAL ON T_PRD_PICKMTRLSERIAL.FENTRYID = T_PRD_PICKMTRLDATA.FENTRYID
	LEFT JOIN T_BD_MATERIALSTOCK ON T_BD_MATERIAL.FMaterialID = T_BD_MATERIALSTOCK.FMATERIALID
	<if test="fbillno != null">
	WHERE T_PRD_PICKMTRL.FBILLNO = '${fbillno}' 
	</if>
	<if test="fid != null">
	WHERE T_PRD_PICKMTRL.FID IN (${fid}) 
	</if>
	GROUP BY 
	T_BD_MATERIAL.FNUMBER,
	T_BD_MATERIAL_L.FNAME,
	T_PRD_PICKMTRLDATA.FAPPQTY,
	T_PRD_PICKMTRLDATA.FSTOCKACTUALQTY,
	T_PRD_PICKMTRLSERIAL.FSERIALNO,
	T_PRD_PICKMTRLDATA.FENTRYID,
	T_BD_MATERIALSTOCK.FISBATCHMANAGE,
	T_PRD_PICKMTRLDATA.FLOT,
	T_PRD_PICKMTRLDATA.FSTOCKID 
	ORDER BY
	T_PRD_PICKMTRLDATA.FENTRYID DESC
</select>
<select id="findprdMsgByPage" resultType="com.ysttench.application.auth.settings.kernel.entity.PrdPickmtrlFormMap">
SELECT
	T_PRD_PICKMTRL.FBILLNO,
	T_PRD_PICKMTRL.FDATE,
	T_PRD_PICKMTRL.FDOCUMENTSTATUS,
	T_BD_MATERIAL.FNUMBER,
	T_BD_MATERIAL_L.FNAME,
	T_PRD_PICKMTRLDATA.FLOT,
	T_BD_UNIT_L.FNAME AS UNITNAME,
	T_PRD_PICKMTRLDATA.FSTOCKACTUALQTY,
	T_ORG_ORGANIZATIONS_L.FNAME AS ORGNAME,
	T_BD_STOCK_L.FNAME AS MANE
FROM
	T_PRD_PICKMTRL
	LEFT JOIN T_PRD_PICKMTRLDATA ON T_PRD_PICKMTRL.FID = T_PRD_PICKMTRLDATA.FID
	LEFT JOIN T_ORG_ORGANIZATIONS_L ON T_PRD_PICKMTRL.FSTOCKORGID = T_ORG_ORGANIZATIONS_L.FORGID
	LEFT JOIN T_BD_MATERIAL ON T_PRD_PICKMTRLDATA.FMATERIALID = T_BD_MATERIAL.FMATERIALID
	LEFT JOIN T_BD_MATERIAL_L ON T_PRD_PICKMTRLDATA.FMATERIALID = T_BD_MATERIAL_L.FMATERIALID
	LEFT JOIN T_BD_UNIT_L ON T_PRD_PICKMTRLDATA.FUNITID = T_BD_UNIT_L.FUNITID 
	LEFT JOIN T_BD_STOCK_L ON T_PRD_PICKMTRLDATA.FSTOCKID = T_BD_STOCK_L.FSTOCKID
	LEFT JOIN T_BD_STOCK ON T_PRD_PICKMTRLDATA.FSTOCKID = T_BD_STOCK.FSTOCKID
	WHERE 1=1
	<if test="searchValue != null and searchValue != ''">
	AND T_PRD_PICKMTRL.FBILLNO like '%${searchValue}%'  OR T_BD_MATERIAL.FNUMBER like '%${searchValue}%' OR T_BD_MATERIAL_L.FNAME like '%${searchValue}%' OR T_ORG_ORGANIZATIONS_L.FNAME like '%${searchValue}%' OR T_PRD_PICKMTRLDATA.FLOT like '%${searchValue}%' OR T_BD_STOCK_L.FNAME like '%${searchValue}%'
	</if>
	<if test="organ != null">
	AND T_ORG_ORGANIZATIONS_L.FNAME ='${organ}'
	</if>
	GROUP BY
	T_PRD_PICKMTRL.FBILLNO,
	T_PRD_PICKMTRL.FDATE,
	T_PRD_PICKMTRL.FDOCUMENTSTATUS,
	T_BD_MATERIAL.FNUMBER,
	T_BD_MATERIAL_L.FNAME,
	T_PRD_PICKMTRLDATA.FLOT,
	T_BD_UNIT_L.FNAME,
	T_PRD_PICKMTRLDATA.FSTOCKACTUALQTY,
	T_ORG_ORGANIZATIONS_L.FNAME,
	T_BD_STOCK_L.FNAME
<if test="column != null">
	order by ${column} ${sort}
</if>
</select>
<select id="findDetailprdMsg" resultType="com.ysttench.application.auth.settings.kernel.entity.PrdPickmtrlFormMap">
SELECT
	T_BAS_BILLTYPE.FNUMBER AS BILLNUMBER,
	T_PRD_PICKMTRLSERIAL.FSERIALNO,
	T_BD_MATERIAL_L.FNAME,
	T_PRD_PICKMTRL.FID,
	T_ORG_ORGANIZATIONS.FNUMBER,
	org.FNUMBER AS PRDORGNUMBER,
	T_BD_MATERIAL.FNUMBER AS MATERILNUMBER,
	UNIT1.FNAME AS FNAME1,
	UNIT2.FNAME AS FNAME2,
	UNIT3.FNAME AS FNAME3,
	T_BD_STOCK.FNUMBER AS STOCKNUMBER,
	T_PRD_PICKMTRLDATA.FMOID,
	T_PRD_PICKMTRLDATA.FMOENTRYID,
	T_PRD_PICKMTRLDATA.FMOBILLNO,
	T_PRD_PICKMTRLDATA.FAPPQTY,
	T_PRD_PICKMTRLDATA.FPRODUCEDATE,
	T_PRD_PICKMTRLDATA.FMOENTRYSEQ,
	T_PRD_PICKMTRLDATA_A.FKEEPERTYPEID,
	org1.FNUMBER AS FKEEPERID,
	T_PRD_PICKMTRLDATA_A.FOWNERTYPEID,
	org2.FNUMBER AS FOWNERID,
	T_PRD_PICKMTRLDATA.FENTRYID,
	T_PRD_PICKMTRLDATA.FEXPIRYDATE,
	T_BD_MATERIALSTOCK.FISBATCHMANAGE,
	T_PRD_PICKMTRLDATA.FLOT  
FROM
	T_PRD_PICKMTRL
	LEFT JOIN T_PRD_PICKMTRLDATA ON T_PRD_PICKMTRL.FID = T_PRD_PICKMTRLDATA.FID
	LEFT JOIN T_ORG_ORGANIZATIONS ON T_PRD_PICKMTRL.FSTOCKORGID = T_ORG_ORGANIZATIONS.FORGID
	LEFT JOIN T_ORG_ORGANIZATIONS org ON T_PRD_PICKMTRL.FPRDORGID = org.FORGID
	LEFT JOIN T_BD_MATERIAL ON T_PRD_PICKMTRLDATA.FMATERIALID = T_BD_MATERIAL.FMATERIALID
	LEFT JOIN T_BD_MATERIAL_L ON T_PRD_PICKMTRLDATA.FMATERIALID = T_BD_MATERIAL_L.FMATERIALID
	LEFT JOIN T_PRD_PICKMTRLSERIAL ON T_PRD_PICKMTRLSERIAL.FENTRYID = T_PRD_PICKMTRLDATA.FENTRYID
	LEFT JOIN T_BD_UNIT_L UNIT1 ON T_PRD_PICKMTRLDATA.FUNITID = UNIT1.FUNITID
	LEFT JOIN T_BD_UNIT_L UNIT2 ON T_PRD_PICKMTRLDATA.FSTOCKUNITID = UNIT2.FUNITID
	LEFT JOIN T_BD_UNIT_L UNIT3 ON T_PRD_PICKMTRLDATA.FBASEUNITID = UNIT3.FUNITID
	LEFT JOIN T_BD_STOCK ON T_PRD_PICKMTRLDATA.FSTOCKID = T_BD_STOCK.FSTOCKID
	LEFT JOIN T_BAS_BILLTYPE ON T_PRD_PICKMTRL.FBILLTYPE = T_BAS_BILLTYPE.FBILLTYPEID
	LEFT JOIN T_PRD_PICKMTRLDATA_A ON T_PRD_PICKMTRL.FID = T_PRD_PICKMTRLDATA_A.FID
	LEFT JOIN T_ORG_ORGANIZATIONS org1 ON T_PRD_PICKMTRLDATA_A.FKEEPERID = org1.FORGID
	LEFT JOIN T_ORG_ORGANIZATIONS org2 ON T_PRD_PICKMTRLDATA_A.FOWNERID = org2.FORGID
	LEFT JOIN T_BD_MATERIALSTOCK ON T_BD_MATERIAL.FMaterialID = T_BD_MATERIALSTOCK.FMATERIALID
	<if test="fid != null">
	WHERE T_PRD_PICKMTRL.FID = '${fid}' 
	</if>
	<if test="fentryid != null">
	AND T_PRD_PICKMTRLDATA.FENTRYID IN (${fentryid})
	</if>
	GROUP BY
	T_BAS_BILLTYPE.FNUMBER ,
	T_PRD_PICKMTRLSERIAL.FSERIALNO,
	T_BD_MATERIAL_L.FNAME,
	T_PRD_PICKMTRL.FID,
	T_ORG_ORGANIZATIONS.FNUMBER,
	org.FNUMBER ,
	T_BD_MATERIAL.FNUMBER ,
	UNIT1.FNAME ,
	UNIT2.FNAME,
	UNIT3.FNAME ,
	T_BD_STOCK.FNUMBER ,
	T_PRD_PICKMTRLDATA.FMOID,
	T_PRD_PICKMTRLDATA.FMOENTRYID,
	T_PRD_PICKMTRLDATA.FMOBILLNO,
	T_PRD_PICKMTRLDATA.FPRODUCEDATE,
	T_PRD_PICKMTRLDATA.FMOENTRYSEQ,
	T_PRD_PICKMTRLDATA_A.FKEEPERTYPEID,
	T_PRD_PICKMTRLDATA.FAPPQTY,
	org1.FNUMBER ,
	T_PRD_PICKMTRLDATA_A.FOWNERTYPEID,
	org2.FNUMBER,
	T_PRD_PICKMTRLDATA.FENTRYID,
	T_PRD_PICKMTRLDATA.FEXPIRYDATE,
	T_BD_MATERIALSTOCK.FISBATCHMANAGE,
	T_PRD_PICKMTRLDATA.FLOT
	ORDER BY
	T_PRD_PICKMTRLDATA.FENTRYID DESC 
</select>
</mapper>